{% extends "base.html" %}
{% load mathfilters %}
{% load mandefilters %}
{% block title %}

{% if exit_survey != None %}<style>div{color: red;}</style>{% endif %}

{{survey.name}} ({{survey.site}})<br/>
    <small>
      <a href="#"><i id="decrement" class="fa fa-arrow-left"></i></a>
        Student ID: <strong id="student_id">{{survey.student_id}}</strong>
      <a href="#"><i id="increment" class="fa fa-arrow-right"></i></a>
    </small><br/>
<a href="{% url 'student_list' %}" class="btn btn-primary" role="button">Back to all students</a>
{% if exit_survey == None %}
  <a href="{% url 'intake_update' survey.student_id %}" class="btn btn-info" role="button">Update this Student's Information?</a>
  {% if current_grade == None %}
  <a href="{% url 'intake_internal' survey.student_id %}" class="btn btn-success" role="button">Enroll this student in VDP</a>
  {% else %}
  <a href="{% url 'exit_survey' survey.student_id %}" class="btn btn-danger" role="button">Perform an exit survey for this student</a>
  {% endif %}
{% endif %}
{% if post_exit_survey == None and exit_survey %}
  <a href="{% url 'post_exit_survey' survey.student_id %}" class="btn btn-danger" role="button">Perform post-exit survey for this student</a>
{% endif %}
<br/>


{% endblock %}

{% block content %}



<div class="row">
  {% if exit_survey %}
    <div class = "col-md-12 text-center">
    <h3>Exit Survey performed on {{exit_survey.survey_date|date:'d N Y'}}</h3>
    <h3>Student will leave the program on {{exit_survey.exit_date|date:'d N Y'}}</h3>
    {% if post_exit_survey %}<h3> A post-exit survey has been performed</h3> {% endif %}
    <br/><br/>
    </div>
  {% endif %}
  <div class = "col-md-3"><div style="background-color: gray; border: 1px solid black; width:175px; height: 225px;"></div>
    <small>Last Update: {% firstof recent_update.date|date:'d N Y' survey.date|date:'d N Y' "Never updated" %}</small>
    </div>
    <div class = "col-md-4">
      <div class = "table-responsive">
        <table class="table table-striped table-hover">
            <tr>
              <td>Gender: </td>
              <td>{{ survey.get_gender_display }}</td>
            </tr>
            <tr>
              <td>DOB: </td>
              <td>{{ survey.dob|date:'d N Y'}} <br/>({{survey.dob|timesince}} old)</td>
            </tr>
            <tr>
              <td>Enrolled: </td>
              <td>{% firstof recent_intake.enrollment_date|date:'d N Y' "Not yet enrolled" %}</td>
            </tr>
            <tr>
              <td>Expected 6th Grade Graduation: </td>
              <td>Jul. {{ graduation|date:'Y' }}</td>
            </tr>
          </table>
        </div>
  </div>
  <div class="col-md-4">
    <div class = "table-responsive">
      <table class="table table-striped table-hover">
          <tr><td>VDP Grade when Enrolled: </td>  <td>{% firstof recent_intake.get_starting_grade_display "Not yet collected" %}</td></tr>
          <tr><td>Current VDP Grade:</td>  <td> {% firstof current_grade|grade_by_id "No academic records found" %}</td></tr>
          <tr><td>Public School Current Grade</td><td>{% firstof recent_survey.get_grade_current_display recent_survey.get_grade_last_display survey.get_grade_current_display survey.get_grade_last_display %}</td></tr>
          {% with grad_date=graduation|date:'Y' %}
          {% if current_grade <= 6 %}
          <tr><td>Grades/Years to achieve</td><td>{{ 6|sub:current_grade }} / {{ grad_date|sub:cur_year }}</td>
          {%endif%}
          </tr>
            {% endwith %}
        </table>
    </div>
  </div>

</div>
<ul class ="nav nav-tabs">
  <li role = "presentation" class="active"><a href="#academic" aria-controls="academic" role="tab" data-toggle="tab">Academic Performance</a></li>
  <li role = "presentation"><a href="#enrollment" aria-controls="contact" role="tab" data-toggle="tab">Course History</a></li>
  <li role = "presentation"><a href="#contact" aria-controls="contact" role="tab" data-toggle="tab">Contact</a></li>
  <li role = "presentation"><a href="#household" aria-controls="household" role="tab" data-toggle="tab">Household</a></li>
  <li role = "presentation"><a href="#notes" aria-controls="notes" role="tab" data-toggle="tab">Notes</a></li>
</ul>

<div class="tab-content">
  <div role="tabpanel" class="tab-pane active" id="academic">
    <div class = "col-md-12">
      <h3>Academics</h3>
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
          <tr>
            <th>Test Date</th>
            <th>Test Grade</th>
            <th>Math</th>
            <th>Khmer</th>
            <th>Promoted?</th>
          </tr>
          {% for test in academics %}
          <tr>
            <td>{{test.test_date|date:'d N Y'}}</td>
            <td>{{test.get_test_level_display}}</td>
            <td>{{test.test_grade_math}}</td>
            <td>{{test.test_grade_khmer}}</td>
            <td>{{test.promote}}</td>
          </tr>
          {% endfor %}

          </table>
          <a href="{% url 'academic_form_single' survey.student_id %}" class="btn btn-success" role="button">Add a semester test</a>
      </div>
    </div>
    <div class="col-md-6">
      <h3>Discipline</h3>
    <table class="table table-bordered table-striped table-hover">
      <tr>
        <th>Date of Incident</th>
        <th>Code</th>

      </tr>
      {% for incident in discipline %}
      <tr>
        <td>{{incident.incident_date|date:'d N Y'}}</td>
        <td>{{incident.get_incident_code_display}}</td>
      </tr>
      {% endfor %}

      </table>
      <a href="{% url 'discipline_form' survey.student_id %}" class="btn btn-danger" role="button">Add Incident</a>
    </div>
    <div class="col-md-6">
      <h3>Attendance</h3>
    <table class="table table-bordered table-striped table-hover">
      <tr>
        <th>Present</th>
        <th>Approved Absences</th>
        <th>Unapproved Absences</th>


      </tr>
      <tr>
        <td>{{attendance_present}}</td>
        <td>{{attendance_approved_absence}}</td>
        <td>{{attendance_unapproved_absence}}</td>

      </tr>

      </table>
      <a href="{% url 'attendance' %}" class="btn btn-warning" role="button">Take Attendance</a>
    </div>


  </div>

  <div role="tabpanel" class="tab-pane" id="enrollment">
    <div class ="col-md-12">
      <h3>Course History:</h3>
      <div class = "table-responsive">
        <table class="table table-bordered table-striped table-hover">
        <tr>
          <th>Date Enrolled</th>
          <th>Date Dropped</th>
          <th>Course</th

        </tr>
        {% for class in classroomenrollment %}
        <tr>
          <td>{{class.enrollment_date|date:'d N Y'}}</td>
          <td>{{class.drop_date|date:'d N Y'}}</td>
          <td>{{class.classroom_id}}</td>
        </tr>
        {% endfor %}

        </table>
        <a href="{% url 'classroomenrollment_form' survey.student_id %}" class="btn btn-success" role="button">Add a classroom</a>
      </div>
    </div>
  </div>
  <div role="tabpanel" class="tab-pane" id="contact">
    <h3>Contact Information</h3>
    <div class="col-md-12">

      <div class = "table-responsive">
        <table class="table table-bordered table-striped table-hover">
              <tr><td colspan=4 class="text-center"><strong>Father</strong></td><td colspan=4 class="text-center"><strong>Mother</strong></td></tr>
              <td><strong>Name:</strong></td>
              <td>{% firstof recent_update.father_name survey.father_name "Not Entered" %}</td>

              <td><strong>Phone:</strong> </td>
              <td>{% firstof recent_update.father_phone survey.father_phone "Not Entered" %}</td>

              <td><strong>Name:</strong> </td>
              <td>{% firstof recent_update.mother_name survey.mother_name "Not Entered" %}</td>

              <td><strong>Phone:</strong> </td>
              <td>{% firstof recent_update.mother_phone survey.mother_phone "Not Entered" %}</td>
            <tr><td colspan=8 class="text-center"><strong>Home Address</strong></td></tr>
            <tr><td colspan=8 class="text-center">{% firstof recent_update.address survey.address "Not Entered" %}</td></tr>
          </table>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="household">
    <div class="col-md-12">
      <h3>Home of Origin</h3>
        <div class = "table-responsive">
          <table class="table table-bordered table-striped table-hover text-center">
              <tr><td colspan=2><strong>Father</strong></td><td colspan=2><strong>Mother</strong></td></tr>
              <tr><td class="info"><strong>Profession</strong></td>
                  <td class="success"><strong>Income</strong></td>
                  <td class="info"><strong>Profession</strong></td>
                  <td class="success"><strong>Income</strong></td></tr>
              <tr>
                <td class="info">{% firstof recent_update.father_profession survey.father_profession "Not Entered" %}</td>
                <td class="success">{% firstof recent_update.father_employment survey.father_employment "Not Entered" %}</td>
                <td class="info">{% firstof recent_update.mother_profession survey.mother_profession "Not Entered" %}</td>
                <td class="success">{% firstof recent_update.mother_employment survey.mother_employment "Not Entered" %}</td>
              </tr>

            </table>
          </div>

      <div class="table-responsive">

        <table class="table table-bordered table-striped table-hover">
          <tr><td><strong>Minors in Household</strong></td><td colspan=3>{% firstof recent_update.minors survey.minors "Not Entered"%}</td></tr>
          <tr><td><strong>Working Minors</strong></td><td>{% firstof recent_update.minors_working survey.minors_working "Not Entered"%}</td>
          <td><strong>Minors in School</strong></td><td>{% firstof recent_update.minors_in_school survey.minors_in_school "Not Entered"%}</td></tr>
        </table>
        <table class="table table-bordered table-striped table-hover">
          <tr><td><strong>What are they doing for work?</strong></td><td colspan=3>{% firstof recent_update.minors_profession survey.minors_profession "Not Entered"%}</td></tr>
          <tr><td><strong>Were they encouraged?</strong></td><td>{% firstof recent_update.minors_encouraged survey.minors_encouraged "Not Entered"%}</td>
              <td><strong>Did they receive any vocational training?</strong></td><td>{% firstof recent_update.minors_training survey.minors_training "Not Entered"%}</td></tr>
          <td><strong>What kind of vocational training did they receive?</strong></td><td colspan=3>{% firstof recent_update.minors_training_type survey.minors_training_type "Not Entered"%}</td></tr>
        </table>
      </div>
    </div>
  </div>
  <div role="tabpanel" class="tab-pane" id="notes">
    <h3>Notes</h3>
    <div class="table-responsive" style="min-height: 3em;">
      <table class="table table-bordered table-striped table-hover">
        <tr><td>{% firstof recent_update.notes survey.notes "No notes entered" %}</td></tr>
      </table>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}

<script type="text/javascript">

$(document).ready( function() {
  $(function() {
    $('#decrement').click(function() {
        //split on /
        $url = window.location.href.split('/')
        $url[$url.length-2] = Number($('#student_id').html())-1
        window.location.href = $url.join('/')
    });
    $('#increment').click(function() {
        //split on /
        $url = window.location.href.split('/')
        $url[$url.length-2] = Number($('#student_id').html())+1
        window.location.href = $url.join('/')
    });
  });
});
</script>
{% endblock %}
